name: Generate README Assets

on:
  schedule:
    - cron: '0 0 * * *'  # Runs daily at midnight UTC
  workflow_dispatch:  # Allows manual trigger

jobs:
  generate-assets:
    name: Generate README Assets
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Set Up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: Fetch GitHub Repository Statistics (Includes Private Repos)
        env:
          GH_TOKEN: ${{ secrets.GH_STATS_TOKEN }}
        run: |
          echo "Fetching repository statistics..."
          curl -H "Authorization: Bearer $GH_TOKEN" \
          -H "Accept: application/vnd.github+json" \
          "https://api.github.com/repos/${{ github.repository }}/stats/contributors" \
          -o stats.json

          curl -H "Authorization: Bearer $GH_TOKEN" \
          -H "Accept: application/vnd.github+json" \
          "https://api.github.com/repos/${{ github.repository }}/stats/code_frequency" \
          -o code_frequency.json

          curl -H "Authorization: Bearer $GH_TOKEN" \
          -H "Accept: application/vnd.github+json" \
          "https://api.github.com/repos/${{ github.repository }}/stats/commit_activity" \
          -o commit_activity.json

          curl -H "Authorization: Bearer $GH_TOKEN" \
          -H "Accept: application/vnd.github+json" \
          "https://api.github.com/repos/${{ github.repository }}/stats/punch_card" \
          -o punch_card.json

      - name: Generate GitHub Readme Stats (Private Repo Support)
        env:
          GH_TOKEN: ${{ secrets.GH_STATS_TOKEN }}
        run: |
          echo "Generating GitHub Readme Stats..."
          curl -H "Authorization: Bearer $GH_TOKEN" \
          "https://github-readme-stats.vercel.app/api?username=${{ github.repository_owner }}&show_icons=true&theme=radical&count_private=true" \
          -o github-readme-stats.svg

          curl -H "Authorization: Bearer $GH_TOKEN" \
          "https://github-readme-stats.vercel.app/api/top-langs/?username=${{ github.repository_owner }}&layout=compact&count_private=true" \
          -o github-top-langs.svg

      - name: Generate Snake Animation
        run: |
          curl "https://github.com/${{ github.repository_owner }}.github.io/snake/snake.svg" \
          -o snake-animation.svg

      - name: Commit and Push Generated Assets
        env:
          GH_TOKEN: ${{ secrets.GH_STATS_TOKEN }}
        run: |
          git config --global user.name "github-actions"
          git config --global user.email "github-actions@github.com"
          git add stats.json code_frequency.json commit_activity.json punch_card.json github-readme-stats.svg github-top-langs.svg snake-animation.svg
          git commit -m "Update README assets [Automated]"
          git push
